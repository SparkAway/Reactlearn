{
  "version": 3,
  "sources": [
    "../src/index.tsx"
  ],
  "names": [
    "delay",
    "time",
    "Promise",
    "resolve",
    "reject",
    "window",
    "setTimeout",
    "DEFAULT_RETRY_TIME",
    "APILoader",
    "props",
    "error",
    "isMountedOk",
    "setState",
    "type",
    "BMap",
    "BMapGL",
    "loaded",
    "state",
    "Map",
    "akay",
    "TypeError",
    "callbackName",
    "waitQueue",
    "push",
    "finish",
    "handleError",
    "loadMap",
    "children",
    "fallback",
    "color",
    "message",
    "cfg",
    "protocol",
    "location",
    "indexOf",
    "args",
    "version",
    "hostAndPath",
    "join",
    "src",
    "getScriptSrc",
    "queue",
    "forEach",
    "task",
    "i",
    "err",
    "Error",
    "res",
    "rej",
    "React",
    "Component"
  ],
  "mappings": "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",
  "sourcesContent": [
    "/**\n * 初始化和加载baidu地图\n */\nimport React from 'react';\nimport { requireScript } from '@uiw/react-baidu-map-utils';\n\ndeclare global {\n  interface Window {\n    [index: string]: () => any; // or just any\n  }\n}\n\nexport interface APILoaderConfig {\n  /**\n   * akay 密钥\n   * 您需先申请密钥（ak）才可使用该服务，接口无使用次数限制，请开发者放心使用。\n   * 文档说明地址：http://lbsyun.baidu.com/index.php?title=jspopular3.0/guide/getkey\n   * 申请秘钥地址：http://lbs.baidu.com/apiconsole/key?application=key\n   */\n  akay: string;\n  /**\n   * SDK 包版本\n   * @default 3.0\n   */\n  version?: string;\n  /**\n   * 协议，默认是根据当前网站协议的\n   */\n  protocol?: 'http' | 'https';\n  /**\n   * 请求 SDK 的前半部分\n   * http://api.map.baidu.com/api?v=2.0&ak=E480562045\n   * @default api.map.baidu.com/api\n   */\n  hostAndPath?: string;\n  /**\n   * JSONP 回调函数\n   */\n  callbackName?: string;\n  /**\n   * 百度地图JavaScript API GL v1.0是一套由JavaScript语言编写的应用程序接口，可帮助您在网站中构建功能丰富、交互性强的地图应用，支持PC端和移动端基于浏览器的地图应用开发，且支持HTML5特性的地图开发。\n   * JavaScript API GL使用了WebGL对地图、覆盖物等进行渲染，支持3D视角展示地图。 GL版本接口基本向下兼容，迁移成本低。目前v1.0版本支持了基本的3D地图展示、基本地图控件和覆盖物。\n   */\n  type?: 'webgl';\n}\n\nexport function delay(time: number): Promise<undefined> {\n  return new Promise((resolve, reject) => {\n    window && window.setTimeout(resolve, time);\n  });\n}\n\nexport interface APILoaderProps extends APILoaderConfig {\n  /**\n   * 用于展示加载中或错误状态\n   */\n  fallback?: (error?: Error) => React.ReactNode;\n}\n\ninterface State {\n  loaded: boolean;\n  error?: Error;\n}\n\nconst DEFAULT_RETRY_TIME = 3;\n\n/**\n * APILoader 用于加载百度地图依赖\n */\nexport default class APILoader extends React.Component<APILoaderProps, State> {\n  public static defaultProps = {\n    akay: '',\n    hostAndPath: 'api.map.baidu.com/api',\n    version: '3.0',\n    callbackName: 'load_bmap_sdk',\n    type: '',\n  };\n\n  private isMountedOk: boolean = false;\n\n  /**\n   * 全局可能存在多个Loader同时渲染, 但是只能由一个负责加载\n   */\n  private static waitQueue: Array<[Function, Function]> = [];\n  /**\n   * 等待BMap就绪\n   */\n  public static async ready() {\n    if (window && window.BMap.Map) {\n      return;\n    }\n    if (window && window.BMapGL.Map) {\n      return;\n    }\n    return new Promise((res, rej) => {\n      APILoader.waitQueue.push([res, rej]);\n    });\n  }\n  public constructor(props: APILoaderProps) {\n    super(props);\n    this.state = {\n      loaded:\n        props.type === 'webgl'\n          ? window && !!window.BMapGL && !!window.BMapGL.Map\n          : window && !!window.BMap && !!window.BMap.Map,\n    };\n    if (this.props.akay == null) {\n      throw new TypeError('BaiDuMap: akay is required');\n    }\n  }\n\n  public componentDidMount() {\n    this.isMountedOk = true;\n    const { callbackName } = this.props;\n    if (!window || !callbackName) {\n      return;\n    }\n    if (\n      (this.props.type === 'webgl' && window && window.BMapGL && !window.BMapGL.Map) ||\n      (this.props.type === 'webgl' && window && !window.BMapGL) ||\n      (window && window.BMap && !window.BMap.Map) ||\n      (window && !window.BMap)\n    ) {\n      if (window && window[callbackName]) {\n        APILoader.waitQueue.push([this.finish, this.handleError]);\n        return;\n      }\n\n      this.loadMap();\n    }\n  }\n\n  componentWillUnmount() {\n    this.isMountedOk = false;\n  }\n\n  public render() {\n    return this.state.loaded ? (\n      this.props.children\n    ) : this.props.fallback ? (\n      this.props.fallback(this.state.error)\n    ) : this.state.error ? (\n      <div style={{ color: 'red' }}>{this.state.error.message}</div>\n    ) : null;\n  }\n\n  private getScriptSrc() {\n    const cfg = this.props;\n    let protocol = (cfg.protocol || window.location.protocol) as APILoaderConfig['protocol'];\n    if (protocol!.indexOf(':') === -1) {\n      protocol += ':';\n    }\n    const args = [`v=${cfg.version}`, `ak=${cfg.akay}`, `callback=${cfg.callbackName}`];\n    if (cfg.type) {\n      args.push(`type=${cfg.type}`);\n    }\n    return `${protocol}//${cfg.hostAndPath}?${args.join('&')}`;\n  }\n  /**\n   * load BaiduMap in script tag\n   */\n  private async loadMap() {\n    const { callbackName } = this.props;\n    if (!window || !callbackName) {\n      return;\n    }\n    const src = this.getScriptSrc();\n    window[callbackName] = () => {\n      // flush queue\n      const queue = APILoader.waitQueue;\n      APILoader.waitQueue = [];\n      queue.forEach((task) => task[0]());\n      this.finish();\n    };\n\n    for (let i = 0; i < DEFAULT_RETRY_TIME; i++) {\n      try {\n        await requireScript(src);\n        break;\n      } catch (error: any) {\n        if (i === DEFAULT_RETRY_TIME - 1) {\n          const err = new Error(`Failed to load Baidu Map: ${error.message}`);\n          // flush queue\n          const queue = APILoader.waitQueue;\n          APILoader.waitQueue = [];\n          queue.forEach((task) => task[1](err));\n          this.handleError(err);\n          return;\n        }\n        await delay(i * 1000);\n      }\n    }\n  }\n\n  private handleError = (error: Error) => {\n    if (this.isMountedOk) {\n      this.setState({ error });\n    }\n  };\n\n  private finish = () => {\n    if (window && this.props.type === 'webgl') {\n      window.BMap = window.BMapGL as any;\n    }\n    if (this.isMountedOk) {\n      this.setState({\n        loaded: true,\n      });\n    }\n  };\n}\n"
  ]
}