{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\n/**\n * 初始化和加载baidu地图\n */\n\nimport React from 'react';\nimport { requireScript } from '@uiw/react-baidu-map-utils';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport function delay(time) {\n  return new Promise((resolve, reject) => {\n    window && window.setTimeout(resolve, time);\n  });\n}\nvar DEFAULT_RETRY_TIME = 3;\n/**\n * APILoader 用于加载百度地图依赖\n */\n\nexport default class APILoader extends React.Component {\n  /**\n   * 全局可能存在多个Loader同时渲染, 但是只能由一个负责加载\n   */\n\n  /**\n   * 等待BMap就绪\n   */\n  static ready() {\n    return _asyncToGenerator(function* () {\n      if (window && window.BMap.Map) {\n        return;\n      }\n\n      if (window && window.BMapGL.Map) {\n        return;\n      }\n\n      return new Promise((res, rej) => {\n        APILoader.waitQueue.push([res, rej]);\n      });\n    })();\n  }\n\n  constructor(props) {\n    super(props);\n    this.isMountedOk = false;\n\n    this.handleError = error => {\n      if (this.isMountedOk) {\n        this.setState({\n          error\n        });\n      }\n    };\n\n    this.finish = () => {\n      if (window && this.props.type === 'webgl') {\n        window.BMap = window.BMapGL;\n      }\n\n      if (this.isMountedOk) {\n        this.setState({\n          loaded: true\n        });\n      }\n    };\n\n    this.state = {\n      loaded: props.type === 'webgl' ? window && !!window.BMapGL && !!window.BMapGL.Map : window && !!window.BMap && !!window.BMap.Map\n    };\n\n    if (this.props.akay == null) {\n      throw new TypeError('BaiDuMap: akay is required');\n    }\n  }\n\n  componentDidMount() {\n    this.isMountedOk = true;\n    var {\n      callbackName\n    } = this.props;\n\n    if (!window || !callbackName) {\n      return;\n    }\n\n    if (this.props.type === 'webgl' && window && window.BMapGL && !window.BMapGL.Map || this.props.type === 'webgl' && window && !window.BMapGL || window && window.BMap && !window.BMap.Map || window && !window.BMap) {\n      if (window && window[callbackName]) {\n        APILoader.waitQueue.push([this.finish, this.handleError]);\n        return;\n      }\n\n      this.loadMap();\n    }\n  }\n\n  componentWillUnmount() {\n    this.isMountedOk = false;\n  }\n\n  render() {\n    return this.state.loaded ? this.props.children : this.props.fallback ? this.props.fallback(this.state.error) : this.state.error ? /*#__PURE__*/_jsx(\"div\", {\n      style: {\n        color: 'red'\n      },\n      children: this.state.error.message\n    }) : null;\n  }\n\n  getScriptSrc() {\n    var cfg = this.props;\n    var protocol = cfg.protocol || window.location.protocol;\n\n    if (protocol.indexOf(':') === -1) {\n      protocol += ':';\n    }\n\n    var args = [\"v=\" + cfg.version, \"ak=\" + cfg.akay, \"callback=\" + cfg.callbackName];\n\n    if (cfg.type) {\n      args.push(\"type=\" + cfg.type);\n    }\n\n    return protocol + \"//\" + cfg.hostAndPath + \"?\" + args.join('&');\n  }\n  /**\n   * load BaiduMap in script tag\n   */\n\n\n  loadMap() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      var {\n        callbackName\n      } = _this.props;\n\n      if (!window || !callbackName) {\n        return;\n      }\n\n      var src = _this.getScriptSrc();\n\n      window[callbackName] = () => {\n        // flush queue\n        var queue = APILoader.waitQueue;\n        APILoader.waitQueue = [];\n        queue.forEach(task => task[0]());\n\n        _this.finish();\n      };\n\n      for (var i = 0; i < DEFAULT_RETRY_TIME; i++) {\n        try {\n          yield requireScript(src);\n          break;\n        } catch (error) {\n          if (i === DEFAULT_RETRY_TIME - 1) {\n            var _ret = function () {\n              var err = new Error(\"Failed to load Baidu Map: \" + error.message); // flush queue\n\n              var queue = APILoader.waitQueue;\n              APILoader.waitQueue = [];\n              queue.forEach(task => task[1](err));\n\n              _this.handleError(err);\n\n              return {\n                v: void 0\n              };\n            }();\n\n            if (typeof _ret === \"object\") return _ret.v;\n          }\n\n          yield delay(i * 1000);\n        }\n      }\n    })();\n  }\n\n}\nAPILoader.defaultProps = {\n  akay: '',\n  hostAndPath: 'api.map.baidu.com/api',\n  version: '3.0',\n  callbackName: 'load_bmap_sdk',\n  type: ''\n};\nAPILoader.waitQueue = [];","map":{"version":3,"mappings":"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","names":["React","requireScript","delay","time","Promise","resolve","reject","window","setTimeout","DEFAULT_RETRY_TIME","APILoader","Component","ready","BMap","Map","BMapGL","res","rej","waitQueue","push","constructor","props","isMountedOk","handleError","error","setState","finish","type","loaded","state","akay","TypeError","componentDidMount","callbackName","loadMap","componentWillUnmount","render","children","fallback","_jsx","style","color","message","getScriptSrc","cfg","protocol","location","indexOf","args","version","hostAndPath","join","_this","src","queue","forEach","task","i","err","Error","v","defaultProps"],"sources":["D:\\HB\\ReactProject\\22_3_8\\backboot\\node_modules\\@uiw\\react-baidu-map-api-loader\\src\\index.tsx"],"sourcesContent":["/**\n * 初始化和加载baidu地图\n */\nimport React from 'react';\nimport { requireScript } from '@uiw/react-baidu-map-utils';\n\ndeclare global {\n  interface Window {\n    [index: string]: () => any; // or just any\n  }\n}\n\nexport interface APILoaderConfig {\n  /**\n   * akay 密钥\n   * 您需先申请密钥（ak）才可使用该服务，接口无使用次数限制，请开发者放心使用。\n   * 文档说明地址：http://lbsyun.baidu.com/index.php?title=jspopular3.0/guide/getkey\n   * 申请秘钥地址：http://lbs.baidu.com/apiconsole/key?application=key\n   */\n  akay: string;\n  /**\n   * SDK 包版本\n   * @default 3.0\n   */\n  version?: string;\n  /**\n   * 协议，默认是根据当前网站协议的\n   */\n  protocol?: 'http' | 'https';\n  /**\n   * 请求 SDK 的前半部分\n   * http://api.map.baidu.com/api?v=2.0&ak=E480562045\n   * @default api.map.baidu.com/api\n   */\n  hostAndPath?: string;\n  /**\n   * JSONP 回调函数\n   */\n  callbackName?: string;\n  /**\n   * 百度地图JavaScript API GL v1.0是一套由JavaScript语言编写的应用程序接口，可帮助您在网站中构建功能丰富、交互性强的地图应用，支持PC端和移动端基于浏览器的地图应用开发，且支持HTML5特性的地图开发。\n   * JavaScript API GL使用了WebGL对地图、覆盖物等进行渲染，支持3D视角展示地图。 GL版本接口基本向下兼容，迁移成本低。目前v1.0版本支持了基本的3D地图展示、基本地图控件和覆盖物。\n   */\n  type?: 'webgl';\n}\n\nexport function delay(time: number): Promise<undefined> {\n  return new Promise((resolve, reject) => {\n    window && window.setTimeout(resolve, time);\n  });\n}\n\nexport interface APILoaderProps extends APILoaderConfig {\n  /**\n   * 用于展示加载中或错误状态\n   */\n  fallback?: (error?: Error) => React.ReactNode;\n}\n\ninterface State {\n  loaded: boolean;\n  error?: Error;\n}\n\nconst DEFAULT_RETRY_TIME = 3;\n\n/**\n * APILoader 用于加载百度地图依赖\n */\nexport default class APILoader extends React.Component<APILoaderProps, State> {\n  public static defaultProps = {\n    akay: '',\n    hostAndPath: 'api.map.baidu.com/api',\n    version: '3.0',\n    callbackName: 'load_bmap_sdk',\n    type: '',\n  };\n\n  private isMountedOk: boolean = false;\n\n  /**\n   * 全局可能存在多个Loader同时渲染, 但是只能由一个负责加载\n   */\n  private static waitQueue: Array<[Function, Function]> = [];\n  /**\n   * 等待BMap就绪\n   */\n  public static async ready() {\n    if (window && window.BMap.Map) {\n      return;\n    }\n    if (window && window.BMapGL.Map) {\n      return;\n    }\n    return new Promise((res, rej) => {\n      APILoader.waitQueue.push([res, rej]);\n    });\n  }\n  public constructor(props: APILoaderProps) {\n    super(props);\n    this.state = {\n      loaded:\n        props.type === 'webgl'\n          ? window && !!window.BMapGL && !!window.BMapGL.Map\n          : window && !!window.BMap && !!window.BMap.Map,\n    };\n    if (this.props.akay == null) {\n      throw new TypeError('BaiDuMap: akay is required');\n    }\n  }\n\n  public componentDidMount() {\n    this.isMountedOk = true;\n    const { callbackName } = this.props;\n    if (!window || !callbackName) {\n      return;\n    }\n    if (\n      (this.props.type === 'webgl' && window && window.BMapGL && !window.BMapGL.Map) ||\n      (this.props.type === 'webgl' && window && !window.BMapGL) ||\n      (window && window.BMap && !window.BMap.Map) ||\n      (window && !window.BMap)\n    ) {\n      if (window && window[callbackName]) {\n        APILoader.waitQueue.push([this.finish, this.handleError]);\n        return;\n      }\n\n      this.loadMap();\n    }\n  }\n\n  componentWillUnmount() {\n    this.isMountedOk = false;\n  }\n\n  public render() {\n    return this.state.loaded ? (\n      this.props.children\n    ) : this.props.fallback ? (\n      this.props.fallback(this.state.error)\n    ) : this.state.error ? (\n      <div style={{ color: 'red' }}>{this.state.error.message}</div>\n    ) : null;\n  }\n\n  private getScriptSrc() {\n    const cfg = this.props;\n    let protocol = (cfg.protocol || window.location.protocol) as APILoaderConfig['protocol'];\n    if (protocol!.indexOf(':') === -1) {\n      protocol += ':';\n    }\n    const args = [`v=${cfg.version}`, `ak=${cfg.akay}`, `callback=${cfg.callbackName}`];\n    if (cfg.type) {\n      args.push(`type=${cfg.type}`);\n    }\n    return `${protocol}//${cfg.hostAndPath}?${args.join('&')}`;\n  }\n  /**\n   * load BaiduMap in script tag\n   */\n  private async loadMap() {\n    const { callbackName } = this.props;\n    if (!window || !callbackName) {\n      return;\n    }\n    const src = this.getScriptSrc();\n    window[callbackName] = () => {\n      // flush queue\n      const queue = APILoader.waitQueue;\n      APILoader.waitQueue = [];\n      queue.forEach((task) => task[0]());\n      this.finish();\n    };\n\n    for (let i = 0; i < DEFAULT_RETRY_TIME; i++) {\n      try {\n        await requireScript(src);\n        break;\n      } catch (error: any) {\n        if (i === DEFAULT_RETRY_TIME - 1) {\n          const err = new Error(`Failed to load Baidu Map: ${error.message}`);\n          // flush queue\n          const queue = APILoader.waitQueue;\n          APILoader.waitQueue = [];\n          queue.forEach((task) => task[1](err));\n          this.handleError(err);\n          return;\n        }\n        await delay(i * 1000);\n      }\n    }\n  }\n\n  private handleError = (error: Error) => {\n    if (this.isMountedOk) {\n      this.setState({ error });\n    }\n  };\n\n  private finish = () => {\n    if (window && this.props.type === 'webgl') {\n      window.BMap = window.BMapGL as any;\n    }\n    if (this.isMountedOk) {\n      this.setState({\n        loaded: true,\n      });\n    }\n  };\n}\n"]},"metadata":{},"sourceType":"module"}