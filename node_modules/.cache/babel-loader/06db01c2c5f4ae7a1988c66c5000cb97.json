{"ast":null,"code":"import { useState, useEffect } from 'react';\nimport { useMapContext } from '@uiw/react-baidu-map-map';\nimport { useProperties, useVisiable, useEventProperties } from '@uiw/react-baidu-map-utils';\nvar EVENTS = ['onClick', 'onMouseOver', 'onMouseOut'];\nexport function usePointCollection(props) {\n  if (props === void 0) {\n    props = {};\n  }\n\n  var {\n    shape,\n    color,\n    size\n  } = props;\n  var {\n    map\n  } = useMapContext();\n  var [points, setPoints] = useState(props.points);\n  var [pointCollection, setPointCollection] = useState();\n\n  var getPoints = function getPoints(data) {\n    if (data === void 0) {\n      data = [];\n    }\n\n    var result = [];\n    data.forEach(item => {\n      result.push(new BMap.Point(item[0], item[1]));\n    });\n    return result;\n  };\n\n  useEffect(() => {\n    if (!BMap || !map) return; // 判断当前浏览器是否支持绘制海量点\n\n    if (document && !document.createElement('canvas').getContext) return;\n    var opts = {\n      shape,\n      color,\n      size\n    };\n\n    if (!pointCollection) {\n      if (!opts.size) opts.size = BMAP_POINT_SIZE_SMALL;\n      if (!opts.shape) opts.shape = BMAP_POINT_SHAPE_WATERDROP;\n      if (!opts.color) opts.color = '#d340c3';\n\n      var _pointCollection = new BMap.PointCollection(getPoints(points), opts); // pointCollection.clear();\n\n\n      map.addOverlay(_pointCollection);\n      setPointCollection(_pointCollection);\n      EVENTS.forEach(evnetName => {\n        if (props[evnetName]) {\n          var name = evnetName.replace(/^on/, '').toLowerCase();\n\n          _pointCollection.addEventListener(name, props[evnetName]);\n        }\n      });\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, [map]);\n  useEffect(() => {\n    if (pointCollection && points) {\n      // pointCollection.clear();\n      pointCollection.setPoints(getPoints(points));\n    }\n  }, [points, pointCollection]);\n  useVisiable(pointCollection, props);\n  useEventProperties(pointCollection, props, ['onClick', 'onMouseOver', 'onMouseOut']);\n  useProperties(pointCollection, props, ['Styles']);\n  return {\n    pointCollection,\n    setPointCollection,\n    points,\n    setPoints\n  };\n}","map":{"version":3,"mappings":"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","names":["useState","useEffect","useMapContext","useProperties","useVisiable","useEventProperties","EVENTS","usePointCollection","props","shape","color","size","map","points","setPoints","pointCollection","setPointCollection","getPoints","data","result","forEach","item","push","BMap","Point","document","createElement","getContext","opts","BMAP_POINT_SIZE_SMALL","BMAP_POINT_SHAPE_WATERDROP","PointCollection","addOverlay","evnetName","name","replace","toLowerCase","addEventListener"],"sources":["D:\\HB\\ReactProject\\22_3_8\\backboot\\node_modules\\@uiw\\react-baidu-map-point-collection\\src\\usePointCollection.ts"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport { useMapContext } from '@uiw/react-baidu-map-map';\nimport { useProperties, useVisiable, useEventProperties } from '@uiw/react-baidu-map-utils';\nimport { PointCollectionProps } from './';\n\nconst EVENTS = ['onClick', 'onMouseOver', 'onMouseOut'];\n\nexport interface UsePointCollection extends PointCollectionProps {}\n\nexport function usePointCollection(props = {} as UsePointCollection) {\n  const { shape, color, size } = props;\n  const { map } = useMapContext();\n  const [points, setPoints] = useState(props.points);\n  const [pointCollection, setPointCollection] = useState<BMap.PointCollection>();\n\n  const getPoints = (data: [number, number][] = []) => {\n    const result: BMap.Point[] = [];\n    data.forEach((item) => {\n      result.push(new BMap.Point(item[0], item[1]));\n    });\n    return result;\n  };\n  useEffect(() => {\n    if (!BMap || !map) return;\n    // 判断当前浏览器是否支持绘制海量点\n    if (document && !document.createElement('canvas').getContext) return;\n    const opts = { shape, color, size };\n    if (!pointCollection) {\n      if (!opts.size) opts.size = BMAP_POINT_SIZE_SMALL;\n      if (!opts.shape) opts.shape = BMAP_POINT_SHAPE_WATERDROP;\n      if (!opts.color) opts.color = '#d340c3';\n      const pointCollection = new BMap.PointCollection(getPoints(points), opts);\n      // pointCollection.clear();\n      map.addOverlay(pointCollection);\n      setPointCollection(pointCollection);\n      EVENTS.forEach((evnetName) => {\n        if ((props as any)[evnetName]) {\n          const name = evnetName.replace(/^on/, '').toLowerCase();\n          pointCollection.addEventListener(name, (props as any)[evnetName]);\n        }\n      });\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [map]);\n\n  useEffect(() => {\n    if (pointCollection && points) {\n      // pointCollection.clear();\n      pointCollection.setPoints(getPoints(points));\n    }\n  }, [points, pointCollection]);\n\n  useVisiable(pointCollection!, props);\n  useEventProperties<BMap.PointCollection, UsePointCollection>(pointCollection!, props, [\n    'onClick',\n    'onMouseOver',\n    'onMouseOut',\n  ]);\n  useProperties<BMap.PointCollection, UsePointCollection>(pointCollection!, props, ['Styles']);\n\n  return {\n    pointCollection,\n    setPointCollection,\n    points,\n    setPoints,\n  };\n}\n"]},"metadata":{},"sourceType":"module"}